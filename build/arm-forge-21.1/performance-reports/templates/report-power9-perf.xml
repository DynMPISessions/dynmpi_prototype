<partialReport name="com.allinea.performancereports.perfmetrics"
               xmlns="http://www.allinea.com/2016/AllineaReports">
    <reportMetrics>

        <!-- Override the breakdown section of the 'CPU' summary to direct to 'Perf Metrics'
             instead of the (absent) 'CPU' subsection -->
        <reportMetric id="overview.cpu.percent" breakdownSubsection="perf"/>

        <reportMetric id="com.allinea.metrics.perf.cycles_per_instruction"
                      displayName="Cycles per instruction"
                      units=""
                      colour="hsl(108, 64, 24)"
                      source="metric">
                      <sourceDetails metricRef="com.allinea.metrics.perf.cycles_per_instruction"
                                     sampleValue="mean"
                                     aggregation="mean"/>
        </reportMetric>

        <reportMetric id="com.allinea.metrics.perf.l3CacheMissesPercentage"
                      displayName="L3 cache miss per instruction"
                      units="â€°"
                      colour="hsl(108, 64, 38)"
                      source="metric">
                      <sourceDetails metricRef="com.allinea.metrics.perf.l3CacheMissesPercentage"
                                     sampleValue="mean"
                                     aggregation="mean"/>
        </reportMetric>

        <reportMetric id="com.allinea.metrics.perf.stalled_cycles_backend_percentage"
                      displayName="Stalled backend cycles"
                      units="%"
                      colour="hsl(108, 64, 38)"
                      source="metric">
                      <sourceDetails metricRef="com.allinea.metrics.perf.stalled_cycles_backend_percentage"
                                     sampleValue="mean"
                                     aggregation="mean"/>
        </reportMetric>
    </reportMetrics>

    <subsections>

        <!-- Remove the 'cpu' section if perf metrics are present -->
        <subsection id="cpu"
                    overwrite="true"
                    maxAdviceStrings="2"
                    requires="com.allinea.metrics.perf.cycles_per_instruction"/>

        <!-- Change the position of the 'perf' subsection to take the place of the
             (absent) 'CPU' subsection -->
        <subsection id="perf"
                    order="-1000"
                    maxAdviceStrings="2"
                    heading="CPU Metrics"
                    colour="hsl(108, 65, 50)"
                    requires="com.allinea.metrics.perf.cycles_per_instruction">
                    <text>Linux perf event metrics:</text>
                    <!-- Show single/OpenMP percentages here rather than in
                         absent 'CPU' subsection. See ALL-6825 for details. -->
                    <entry  reportMetric="cpu.singleCorePercent"
                            order="-120"
                            requires="applicationDetails.isOpenMp" />
                    <entry  reportMetric="cpu.openMpPercent"
                            order="-110"
                            requires="applicationDetails.isOpenMp" />
                    <entry  reportMetric="com.allinea.metrics.perf.cycles_per_instruction"
                            order="-90"
                            group="barDisabled"/>
                    <entry  reportMetric="com.allinea.metrics.perf.l3CacheMissesPercentage"
                            order="-80"
                            maxBarValue="1000"
                            group="cpu"/>
                    <entry  reportMetric="com.allinea.metrics.perf.stalled_cycles_backend_percentage"
                            order="-70"
                            maxBarValue="100"
                            group="cpu"/>
            </subsection>
    </subsections>
</partialReport>
