#!/bin/sh

OLD_LD_PRELOAD=$LD_PRELOAD
LD_PRELOAD=
export LD_PRELOAD

#First find ALLINEA_TOOLS_PATH
_CWD=`pwd`

# Follow symlinks
CANONICAL_EXE=`readlink -f $0 2>/dev/null`
if [ $? -ne 0 ]; then
        CANONICAL_EXE="$0"
fi

cd `dirname $CANONICAL_EXE`/..
ALLINEA_TOOLS_PATH=`pwd`
cd $_CWD

# DDTPATH is an alias of ALLINEA_TOOLS_PATH for backwards compatibility
DDTPATH=$ALLINEA_TOOLS_PATH
export DDTPATH
export ALLINEA_TOOLS_PATH

# Set path
PATH="$ALLINEA_TOOLS_PATH/bin${PATH:+:$PATH}"
export PATH

# Set library paths
for lib_path in lib lib/64
do
    LD_LIBRARY_PATH="$ALLINEA_TOOLS_PATH/${lib_path}${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}"
done
export LD_LIBRARY_PATH

LD_PRELOAD=$OLD_LD_PRELOAD

exec "$ALLINEA_TOOLS_PATH/libexec/forge-backend" --ddtmanuallaunch "$@"
