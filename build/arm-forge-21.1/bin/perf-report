#!/bin/sh

PRODUCT_NAME="Arm Performance Reports"
LD_PRELOAD=

# First find ALLINEA_REPORTS_PATH. Don't set this is in your environment - this script will
# find it.

# Follow symlinks to get the canonical path of this script (in case we're symlinked outside the install directory).
if type readlink >/dev/null 2>&1; then
	CANONICAL_EXE="`readlink -f "$0"`"
else
	CANONICAL_EXE="$0"
fi

# Set ALLINEA_REPORTS_PATH to the parent of the DDT executable's directory.
ALLINEA_REPORTS_PATH="$(cd "$(dirname "$CANONICAL_EXE")/.."; pwd)"
. "$ALLINEA_REPORTS_PATH/libexec/common"

PERF_ARGS="-name performance-reports --tool=perf-report"
PERF_LAUNCHER="$ALLINEA_REPORTS_PATH/libexec/forge-offline"

if [ -n "${FLUENT_MPI_PRE}" ]; then
    echo "Performance Reports: Running in ANSYS Fluent compatibility mode."
    if [ -w /dev/tty -a -z "${ALLINEA_NO_DEV_TTY_FOR_FLUENT}" ]; then
        log=/dev/tty
    else
        log="map$(date +'%Y%m%d%H%M%S').log"
        echo "Performance Reports: Logging to ${log}."
    fi
    exec >${log} 2>&1
fi

if [ -n "${ALLINEA_ENABLE_CORE_DUMP}" ]; then
    ulimit -c unlimited
fi

exec $SSH_AGENT $PERF_LAUNCHER "$ALLINEA_REPORTS_PATH/libexec/forge.bin" $PERF_ARGS "$@"
